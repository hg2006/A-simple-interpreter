<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>12&nbsp;Q5 (posted February 9, due February 28)</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble-style.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CS 146 Assignment Questions</a></td></tr></table></div><div class="tocviewsublistonly" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Q1__posted_January_12__due_January_19_.html" class="tocviewlink" data-pltdoc="x">Q1 (posted January 12, due January 19)</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Q2__posted_January_12__due_January_19_.html" class="tocviewlink" data-pltdoc="x">Q2 (posted January 12, due January 19)</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Q3__posted_January_17__due_January_24_.html" class="tocviewlink" data-pltdoc="x">Q3 (posted January 17, due January 24)</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="C1__Posted_January_24__due_January_31_.html" class="tocviewlink" data-pltdoc="x">C1 (Posted January 24, due January 31)</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="C2__Posted_January_24__due_January_31_.html" class="tocviewlink" data-pltdoc="x">C2 (Posted January 24, due January 31)</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Q4__posted_January_24__due_January_31_.html" class="tocviewlink" data-pltdoc="x">Q4 (posted January 24, due January 31)</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="C3__Posted_January_31__due_February_7_.html" class="tocviewlink" data-pltdoc="x">C3 (Posted January 31, due February 7)</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="C4___Posted_January_31__due_February_7_.html" class="tocviewlink" data-pltdoc="x">C4  (Posted January 31, due February 7)</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="C5__Posted_January_31__due_February_7_.html" class="tocviewlink" data-pltdoc="x">C5 (Posted January 31, due February 7)</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="C6__Posted_January_31__due_February_7_.html" class="tocviewlink" data-pltdoc="x">C6 (Posted January 31, due February 7)</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="C7__Posted_February_9__due_February_16_.html" class="tocviewlink" data-pltdoc="x">C7 (Posted February 9, due February 16)</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Q5 (posted February 9, due February 28)</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="C8__posted_February_16__due_March_2_.html" class="tocviewlink" data-pltdoc="x">C8 (posted February 16, due March 2)</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="C9__Posted_February_16__due_March_2_.html" class="tocviewlink" data-pltdoc="x">C9 (Posted February 16, due March 2)</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Q6__posted_March_2__due_March_9_.html" class="tocviewlink" data-pltdoc="x">Q6 (posted March 2, due March 9)</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="C10__Posted_March_2__due_March_9_.html" class="tocviewlink" data-pltdoc="x">C10 (Posted March 2, due March 9)</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="Q7__posted_March_7__due_March_14_.html" class="tocviewlink" data-pltdoc="x">Q7 (posted March 7, due March 14)</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="C11__Posted_March_9__due_March_16_.html" class="tocviewlink" data-pltdoc="x">C11 (Posted March 9, due March 16)</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="Q8__posted_March_15__due_March_28_.html" class="tocviewlink" data-pltdoc="x">Q8 (posted March 15, due March 28)</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="Q9__posted_March_16__due_March_29_.html" class="tocviewlink" data-pltdoc="x">Q9 (posted March 16, due March 29)</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="C12__posted_March_21__Due_March_28_.html" class="tocviewlink" data-pltdoc="x">C12 (posted March 21, Due March 28)</a></td></tr><tr><td align="right">22&nbsp;</td><td><a href="Q10__posted_March_23__due_April_5_.html" class="tocviewlink" data-pltdoc="x">Q10 (posted March 23, due April 5)</a></td></tr><tr><td align="right">23&nbsp;</td><td><a href="M1__Posted_March_28__due_April_5_.html" class="tocviewlink" data-pltdoc="x">M1 (Posted March 28, due April 5)</a></td></tr><tr><td align="right">24&nbsp;</td><td><a href="C13__Posted_March_30__due_April_10_.html" class="tocviewlink" data-pltdoc="x">C13 (Posted March 30, due April 10)</a></td></tr><tr><td align="right">25&nbsp;</td><td><a href="C14__Posted_March_30__due_April_10_.html" class="tocviewlink" data-pltdoc="x">C14 (Posted March 30, due April 10)</a></td></tr><tr><td align="right">26&nbsp;</td><td><a href="Final_Assessment.html" class="tocviewlink" data-pltdoc="x">Final Assessment</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="C7__Posted_February_9__due_February_16_.html" title="backward to &quot;11 C7 (Posted February 9, due February 16)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CS 146 Assignment Questions&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="C8__posted_February_16__due_March_2_.html" title="forward to &quot;13 C8 (posted February 16, due March 2)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>12<tt>&nbsp;</tt><a name="(part._.Q5__posted_.February_9__due_.February_28_)"></a>Q5 (posted February 9, due February 28)</h3><p></p><p><span style="font-weight: bold">Language:</span> Racket.</p><p>The starter code provided for this question (which you may use in subsequent
interpreter questions also) is a bare-bones Faux Racket interpreter.
It is available <a href="Q5-starter.rkt">here</a>. Make sure you understand it.</p><p>In this question, you will add <span class="stt">rec</span> (implementing <span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._letrec%29%29" class="RktStxLink" data-pltdoc="x">letrec</a></span>) and <span class="stt">ifzero</span>
(implementing short-circuit <span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> with a <span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._zero~3f%29%29" class="RktValLink" data-pltdoc="x">zero?</a></span> test) to the
interpreted language. Just as <span class="stt">with</span>
was a version of <span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span> permitting just one binding, <span class="stt">rec</span> is
a version of <span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._letrec%29%29" class="RktStxLink" data-pltdoc="x">letrec</a></span> permitting just one binding.
Here is the grammar for the interpreted language.</p><p><table cellspacing="0" cellpadding="0"><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">num</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">var</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2F%29%29" class="RktValLink" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym">fun</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">var</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym">ifzero</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym">with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym">rec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVar">var</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr></table></p><p>Here are the new AST structures.</p><p><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rec</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">nm</span><span class="hspace">&nbsp;</span><span class="RktSym">nmd</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ifzero</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktSym">tb</span><span class="hspace">&nbsp;</span><span class="RktSym">fb</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr></table></p><p>Why is the implementation of <span class="stt">rec</span> harder than <span class="stt">with</span>?
Consider interpreting an expression of the form <span class="RktPn">(</span><span class="RktSym">rec</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="stt"> </span><span class="RktSym">E</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">B</span><span class="RktPn">)</span>,
where <span class="RktSym">E</span> and <span class="RktSym">B</span> are arbitrary expressions.
We need to interpret <span class="RktSym">E</span> in the current environment <span class="RktSym">e</span>, which
does not have a binding for <span class="RktSym">x</span>, even though <span class="RktSym">x</span> may
be mentioned in <span class="RktSym">E</span>. If <span class="RktSym">x</span> is mentioned in <span class="RktSym">E</span>,
it should be in the body of a <span class="RktSym">fun</span>, and those are not interpreted
until the function is applied, so the binding of <span class="RktSym">x</span> will not
be needed during the interpretation of <span class="RktSym">E</span>.
However, if <span class="RktSym">E</span> evaluates to a closure <span class="RktSym">c</span>,
then <span class="RktSym">c</span> contains an environment <span class="RktSym">f</span>, and <span class="RktSym">f</span>
will extend <span class="RktSym">e</span> and thus not have a binding for <span class="RktSym">x</span>.
So <span class="RktSym">c</span> cannot be bound to <span class="RktSym">x</span> and successfully used to
evaluate <span class="RktSym">B</span> (unless <span class="RktSym">B</span> does not mention <span class="RktSym">x</span> at all).</p><p>We can create a closure <span class="RktSym">d</span> whose environment <span class="RktSym">g</span> extends <span class="RktSym">f</span>
with a binding for <span class="RktSym">x</span> (and can thus be successfully
used to evaluate <span class="RktSym">B</span>), but what should that binding be?
It should be to <span class="RktSym">d</span>. The data structure is circular,
and circular data structures cannot be created using pure code.</p><p>One efficient solution to this problem is to use a mutable structure for closures
by adding the keyword <span class="RktPn">#:mutable</span>.
We can then create <span class="RktSym">d</span> with a "dummy" value in the environment
field (say, the value <span class="RktVal">'</span><span class="RktVal">undefined</span>), create the extended
environment <span class="RktSym">g</span>, and then mutate the environment field
of <span class="RktSym">d</span> so that its new value is <span class="RktSym">g</span>. This is the
only use of mutation permitted in your interpreter.</p><p>Our test expressions will be of the form <span class="RktPn">(</span><span class="RktSym">parse</span><span class="stt"> </span><span class="RktSym">E</span><span class="RktPn">)</span>
and <span class="RktPn">(</span><span class="RktSym">interp</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="stt"> </span><span class="RktSym">E</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._empty%29%29" class="RktValLink" data-pltdoc="x">empty</a></span><span class="RktPn">)</span>,
where <span class="RktSym">E</span> is an expression described by the above grammar.</p><p>Please make sure that you add the keyword <span class="RktPn">#:transparent</span>
to all of your structures, or your code may fail Marmoset tests
for reasons unrelated to its correctness (because opaque structures
cannot be properly tested for equality). The starter code raises
an error containing the string "unbound" if a variable lookup fails;
please preserve this property in your solution to this question, as well
as in subsequent interpreter questions.</p><p><span style="font-weight: bold">To submit:</span> <span class="stt">Q5.rkt</span>.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="C7__Posted_February_9__due_February_16_.html" title="backward to &quot;11 C7 (Posted February 9, due February 16)&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CS 146 Assignment Questions&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="C8__posted_February_16__due_March_2_.html" title="forward to &quot;13 C8 (posted February 16, due March 2)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>